<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/templates/Layout.xhtml">

	<ui:define name="content">
		<section class="r42-pagina">

			<!-- execução inicial-->
			<f:metadata>
				<f:viewAction action="#{controleProduto.listar}" />
			</f:metadata>

			<h:form id="frm">

				<!-- Mensagem Form -->
				<p:growl id="msg-frm" showDetail="true" />

				<!-- Barra Ferramentas -->
				<p:toolbar styleClass="r42-toolbar" id="toolbar">
					<p:toolbarGroup align="left">
						<p:commandButton id="bto-novo" title="Novo" icon="fa fa-file"
							actionListener="#{controleProduto.novoCadastro}" process="@this"
							update="dialogo" oncomplete="PF('wgDados').show()">
							<p:resetInput target="dialogo" />
						</p:commandButton>
						<p:commandButton id="bto-editar" title="Editar"
							icon="fa fa-pencil" process="@this" update="dialogo"
							oncomplete="PF('wgDados').show()"
							disabled="#{controleProduto.produtoSelect == null}"
							actionListener="#{controleProduto.editCadastro}">
							<p:resetInput target="dialogo" />
						</p:commandButton>
						<p:commandButton id="bto-excluir" title="Excluir"
							icon="fa fa-trash" process="@this"
							disabled="#{controleProduto.produtoSelect == null}"
							update="tabela msg-frm toolbar"
							actionListener="#{controleProduto.excluir}">
							<p:confirm icon="fa fa-warning" header="Exclusão de Registro"
								message="Confirma a exclusão do Produto?" />
						</p:commandButton>
					</p:toolbarGroup>
					<p:toolbarGroup align="right" styleClass="r42-toolbar-right">
						<p:outputLabel value="Produtos" />
					</p:toolbarGroup>
				</p:toolbar>

				<!-- Listagem dos dados -->
				<p:dataTable value="#{controleProduto.listaProdutos}" var="produto"
					id="tabela" reflow="true" rows="15" paginator="true"
					paginatorPosition="top"
					selection="#{controleProduto.produtoSelect}" selectionMode="single"
					rowKey="#{produto.idProduto}"
					emptyMessage="Nenhum Produto Cadastrado">

					<!-- Evento ajax, que atuliza a barra de ferramentas, quando marca/desmarca uma linha -->
					<p:ajax event="rowSelect" update=":frm:toolbar" />
					<p:ajax event="rowUnselect" update=":frm:toolbar" />

					<!-- Colunas -->
					<p:column headerText="Id" width="50" sortBy="#{produto.idProduto}">
						<h:outputText value="#{produto.idProduto}" />
					</p:column>
					<p:column headerText="Descrição" width="300"
						sortBy="#{produto.descricao}">
						<h:outputText value="#{produto.descricao}" />
					</p:column>
					<p:column headerText="Categoria" width="100"
						sortBy="#{produto.categoria.descricao}">
						<h:outputText value="#{produto.categoria.descricao}" />
					</p:column>
					<p:column headerText="Unidade Medida" width="100"
						sortBy="#{produto.produtoUM.idUm}">
						<h:outputText
							value="#{produto.produtoUM.unidade} - #{produto.produtoUM.descricao}" />
					</p:column>
				</p:dataTable>

				<!-- Dialogo inclusão/alteração -->
				<p:dialog styleClass="r42-dialogo"
					header="Dados Produto #{controleProduto.produtoEdicao.idProduto}"
					widgetVar="wgDados" id="dialogo" modal="true" resizable="false"
					responsive="true">

					<!-- Barra de Ferramentas dialogo-->
					<p:defaultCommand target="bto-salvar" scope="dialogo" />
					<p:toolbar>
						<p:toolbarGroup align="left">
							<p:commandButton id="bto-salvar" title="Salvar" icon="fa fa-save"
								action="#{controleProduto.salvar}" process="dialogo"
								update="panel-dados"
								oncomplete="if(!args.validationFailed) PF('wgDados').hide()" />
						</p:toolbarGroup>
					</p:toolbar>

					<p:messages id="messages" showDetail="false" autoUpdate="true"
						closable="true" />

					<!-- Dados Dialogo -->
					<p:tabView id="panel-dados">

						<!-- Aba Dados Produto -->
						<p:tab title="Definições">

							<p:panelGrid columns="2" layout="grid"
								styleClass="panelgrid-noborder r42-panelgrid"
								columnClasses="ui-grid-col-3, ui-grid-col-9">


								<p:outputLabel value="Código" for="idProduto" />
								<p:inputText id="idProduto" size="15" maxlength="15"
									value="#{controleProduto.produtoEdicao.idProduto}"
									disabled="true" />

								<p:outputLabel value="Descrição" for="descricao" />
								<p:inputText id="descricao" size="50" maxlength="50"
									value="#{controleProduto.produtoEdicao.descricao}"
									onblur="value=value.toUpperCase()" />

								<p:outputLabel value="Grupo" for="grupo" />
								<p:selectOneMenu id="grupo"
									value="#{controleProduto.produtoEdicao.grupo}"
									converter="converterGrupo">
									<f:selectItem itemLabel="Selecione" />
									<f:selectItems value="#{controleProduto.grupos}"
										var="grupo" itemLabel="#{grupo.descricao}"
										itemValue="#{grupo}" />
								</p:selectOneMenu>

								<p:outputLabel value="Unid. medida" for="um" />
								<p:selectOneMenu id="um"
								    var="produtoUM"
									value="#{controleProduto.produtoEdicao.produtoUM}"
									converter="converterUnidMedida">
									<f:selectItem itemLabel="Selecione" />
									<f:selectItems value="#{controleProduto.produtoUMs}"
									               var="itm_um"
										           itemValue="#{itm_um}"
										           itemLabel="#{itm_um.unidade}" />
										
									<p:column style="width:10%">
										<h:outputText value="#{produtoUM.unidade}" />
									</p:column>
									<p:column>
										<h:outputText value="#{produtoUM.descricao}" />
									</p:column>
								</p:selectOneMenu>

								<p:outputLabel value="Categoria" for="categoria" />
								<p:selectOneMenu id="categoria"
									value="#{controleProduto.produtoEdicao.categoria}"
									converter="converterCategoria">
									<f:selectItem itemLabel="Selecione" />
									<f:selectItems value="#{controleProduto.categorias}"
										var="categoria" itemLabel="#{categoria.descricao}"
										itemValue="#{categoria}" />
								</p:selectOneMenu>
								<h:outputText value="Ativo" />
								<p:selectBooleanCheckbox
									value="#{controleProduto.produtoEdicao.ativo}" />

								<h:outputText value="Controla estoque" />
								<p:selectBooleanCheckbox
									value="#{controleProduto.produtoEdicao.controlaEstoque}" />

							</p:panelGrid>

						</p:tab>

						<!-- Aba Estoque -->
						<p:tab title="Estoque">

							<p:panelGrid columns="2" layout="grid"
								styleClass="panelgrid-noborder r42-panelgrid"
								columnClasses="ui-grid-col-3, ui-grid-col-9">


								<p:outputLabel value="Saldo estoque" for="saldoEstoque" />
								<p:inputNumber id="saldoEstoque" size="20"
									value="#{controleProduto.produtoEdicao.saldoEstoque}"
									decimalPlaces="3" decimalSeparator="," thousandSeparator="."
									desable="true" />

								<p:outputLabel value="Valor custo" for="valorCusto" />
								<p:inputNumber id="valorCusto" size="20"
									value="#{controleProduto.produtoEdicao.valorCusto}"
									decimalPlaces="2" decimalSeparator="," thousandSeparator="."
									desable="true" />

								<p:outputLabel value="Acrescimo" for="acrescimo" />
								<p:inputNumber id="acrescimo" size="20" symbol="%"
									symbolPosition="s" maxvalue="9999.99"
									value="#{controleProduto.produtoEdicao.aliqAcrescimo}"
									decimalPlaces="3" decimalSeparator="," thousandSeparator="." />

								<p:outputLabel value="Valor acrescimo" for="valorAcrescimo" />
								<p:inputNumber id="valorAcrescimo" size="20"
									value="#{controleProduto.produtoEdicao.valorAcrescimo}"
									decimalPlaces="2" decimalSeparator="," thousandSeparator="." />

								<p:outputLabel value="Preço venda" for="precoVenda" />
								<p:inputNumber id="precoVenda" size="20"
									value="#{controleProduto.produtoEdicao.precoVenda}"
									decimalPlaces="2" decimalSeparator="," thousandSeparator="." />

							</p:panelGrid>

						</p:tab>
					</p:tabView>

				</p:dialog>

			</h:form>
		</section>
	</ui:define>
</ui:composition>