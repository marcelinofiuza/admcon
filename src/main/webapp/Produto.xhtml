<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core" 
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/templates/Layout.xhtml">

	<ui:define name="content">
		<section class="r42-pagina">
		
			<!-- execução inicial-->
			<f:metadata>
				<f:viewAction action="#{controleProduto.listar}" />
			</f:metadata> 
			
            <h:form id="frm">   
                     
                <!-- Mensagem Form -->
                <p:growl id="msg-frm" showDetail="true"/>
                
  				<!-- Barra Ferramentas -->
				<p:toolbar styleClass="r42-toolbar" id="toolbar">
					<p:toolbarGroup align="left">
						<p:commandButton    id="bto-novo" 
											title="Novo" 
											icon="fa fa-file" 
											actionListener="#{controleProduto.novoCadastro}"
											process="@this"
											update="dialogo"
											oncomplete="PF('wgDados').show()">
											<p:resetInput target="dialogo" />
						</p:commandButton>
						<p:commandButton    id="bto-editar" 
						                    title="Editar" 
						                    icon="fa fa-pencil" 
						                    process="@this"
						                    update="dialogo"
						                    oncomplete="PF('wgDados').show()" 
							                disabled="#{controleProduto.produtoSelect == null}"
							                actionListener="#{controleProduto.editCadastro}">
							                <p:resetInput target="dialogo" />
						</p:commandButton>
						<p:commandButton    id="bto-excluir" 
						                    title="Excluir" 
						                    icon="fa fa-trash" 
						                    process="@this"
						                    disabled="#{controleProduto.produtoSelect == null}" 
							                update="tabela msg-frm toolbar"
							                actionListener="#{controleProduto.excluir}">
							                <p:confirm icon="fa fa-warning" header="Exclusão de Registro" message="Confirma a exclusão do Produto?" />
						</p:commandButton>
					</p:toolbarGroup>
					<p:toolbarGroup align="right" styleClass="r42-toolbar-right">
						<p:outputLabel value="Produtos"/>
					</p:toolbarGroup>
				</p:toolbar>
  	
				<!-- Listagem dos dados -->
				<p:dataTable value="#{controleProduto.listaProdutos}" 
				             var="produto" 
				             id="tabela" 
				             reflow="true" 
				             rows="15" paginator="true"
					         paginatorPosition="top" 
					         selection="#{controleProduto.produtoSelect}" 
					         selectionMode="single" rowKey="#{produto.idProduto}"
					         emptyMessage="Nenhum Produto Cadastrado">
				
				    <!-- Evento ajax, que atuliza a barra de ferramentas, quando marca/desmarca uma linha -->
					<p:ajax event="rowSelect" update=":frm:toolbar" />
					<p:ajax event="rowUnselect" update=":frm:toolbar" />
					
				    <!-- Colunas -->
				    <p:column headerText="Id" width="50" sortBy="#{produto.idProduto}">
						<h:outputText value="#{produto.idProduto}" />
					</p:column>
                    <p:column headerText="Descrição" width="300" sortBy="#{produto.descricao}">
                        <h:outputText value="#{produto.descricao}" />
                    </p:column>					
					<p:column headerText="Categoria" width="100" sortBy="#{produto.categoria.descricao}">
						<h:outputText value="#{produto.categoria.descricao}" />
					</p:column>
					<p:column headerText="Unidade Medida" width="100" sortBy="#{produto.produtoUM.idUm}">
						<h:outputText value="#{produto.produtoUM.idUm} - #{produto.produtoUM.descricao}" />
					</p:column>
				</p:dataTable>      

				<!-- Dialogo inclusão/alteração -->
				<p:dialog styleClass="r42-dialogo" 
				          header="Dados Produto #{controleProduto.produtoEdicao.idProduto}" 
				          widgetVar="wgDados" 
				          id="dialogo" 
				          modal="true" 
				          resizable="false"
					      responsive="true">
					      
					<!-- Barra de Ferramentas dialogo-->
					<p:defaultCommand target="bto-salvar" scope="dialogo" />
					<p:toolbar>
						<p:toolbarGroup align="left">
							<p:commandButton id="bto-salvar" 
							                 title="Salvar" 
							                 icon="fa fa-save" 
							                 action="#{controleProduto.salvar}" 
							                 process="dialogo"
								             update="panel-dados" 
								             oncomplete="if(!args.validationFailed) PF('wgDados').hide()" />
						</p:toolbarGroup>
					</p:toolbar>
					
					<p:messages id="messages" showDetail="false" autoUpdate="true" closable="true" />

					<!-- Dados Dialogo -->
					<p:tabView id="panel-dados">
						<!-- Aba Dados Produto -->
						
						<p:tab title="Definições">
						
							<p:panelGrid columns="2" 
							             layout="grid" 
							             styleClass="panelgrid-noborder r42-panelgrid"
								         columnClasses="ui-grid-col-3, ui-grid-col-9">

								         
								<p:outputLabel value="Código" for="idProduto" />
								<p:inputText id="idProduto" size="50" maxlength="50" 
								             value="#{controleProduto.produtoEdicao.idProduto}"
									         disabled="true" />
									         
								<p:outputLabel value="Descrição" for="descricao" />
								<p:inputText id="descricao" size="50" maxlength="50" 
								             value="#{controleProduto.produtoEdicao.descricao}"
									         onblur="value=value.toUpperCase()" />
								         
								         
							</p:panelGrid>
							
						</p:tab>							
					
					</p:tabView>								         

				</p:dialog>
        	</h:form>		
		</section>
	</ui:define>
</ui:composition>